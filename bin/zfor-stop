#!/bin/sh

ROOT=$(ROOT)
ERL=$ROOT/bin/erl
ERL_NAME=zfor_admin@127.0.0.1
ZFORD_ERL_NAME=zford@127.0.0.1

NEW_CWD=/tmp
HOME_DIR=$ROOT/conf/zfor

# 启动erlang daemon时当前目录必须能在启动用户身份下访问
cd $NEW_CWD

# 设置HOME目录以满足erlang解释器要求，让解释器在此处读取.erlang.cookie文件
export HOME=$HOME_DIR

# 远程停止zfor服务，由于zfor服务由heart进程守护，因此要临时将heart重启命令设为无用的程序
# 再结束zfor服务。若不这样处理，zfor服务退出后将自动被heart进程重新启动
$ERL -name $ERL_NAME -noshell -noinput \
	-eval "rpc:call('$ZFORD_ERL_NAME',heart,set_cmd,[\"true\"])" \
	-eval "rpc:call('$ZFORD_ERL_NAME',init,stop,[]), halt()"

